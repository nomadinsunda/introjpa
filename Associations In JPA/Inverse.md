# ğŸ” JPA ì—°ê´€ê´€ê³„ "inverse" ê°œë…

## 1ï¸âƒ£ ìš©ì–´ ì •ë¦¬ë¶€í„° ì‹œì‘í•˜ì

| ìš©ì–´                    | ì˜ë¯¸                                        |
| --------------------- | ----------------------------------------- |
| **ì—°ê´€ê´€ê³„ ì£¼ì¸(owner)**    | ì™¸ë˜ í‚¤ë¥¼ ì‹¤ì œë¡œ **ê´€ë¦¬**í•˜ê³  **ë³€ê²½**í•˜ëŠ” ìª½             |
| **ì—°ê´€ê´€ê³„ ë¹„ì£¼ì¸(inverse)** | ì™¸ë˜ í‚¤ë¥¼ ê°–ì§€ ì•Šê³ , **ê±°ìš¸ì²˜ëŸ¼ ë°˜ì˜ë§Œ í•˜ëŠ” ìª½**            |
| **`mappedBy`**        | "ë‚˜ëŠ” ë¹„ì£¼ì¸ì´ë©°, ì£¼ì¸ì€ ìƒëŒ€ ì—”í‹°í‹°ì˜ ì´ í•„ë“œì…ë‹ˆë‹¤"ë¼ê³  JPAì— ì•Œë¦¼ |

---

## 2ï¸âƒ£ ì§„ì§œ ë¬¸ì œëŠ” **ì–‘ë°©í–¥ ë§¤í•‘**ì—ì„œ ìƒê¸´ë‹¤

JPAëŠ” ê°ì²´ì§€í–¥ ì–¸ì–´ì¸ Javaì™€ ê´€ê³„í˜• DB ê°„ì˜ \*\*"ë¶ˆì¼ì¹˜(O/R Impedance Mismatch)"\*\*ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê¸°ìˆ ì…ë‹ˆë‹¤.

Javaì—ì„œëŠ” ê°ì²´ ê°„ì— **ì–‘ë°©í–¥ ì°¸ì¡°**ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```java
member.setTeam(team);
team.getMembers().add(member);
```

í•˜ì§€ë§Œ ê´€ê³„í˜• DBì—ì„œëŠ” \*\*ë‹¨ë°©í–¥ ì°¸ì¡°(ì™¸ë˜ í‚¤ëŠ” í•œìª½ì—ë§Œ ì¡´ì¬)\*\*ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

> âœ… ê²°êµ­, JPAëŠ” ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„ë¥¼ DBì˜ ë‹¨ë°©í–¥ ì™¸ë˜ í‚¤ ì œì•½ìœ¼ë¡œ **í•´ì„**í•´ì•¼ í•©ë‹ˆë‹¤.
> ì´ë•Œ, â€œëˆ„ê°€ ì™¸ë˜ í‚¤ë¥¼ ì¡°ì‘í• ì§€â€ë¥¼ **ëª…í™•íˆ ì§€ì •í•´ì•¼ í•˜ëŠ”ë°**,
> ë°”ë¡œ ê·¸ ê²°ì •ì´ `owner` vs `inverse`ì…ë‹ˆë‹¤.

---

## 3ï¸âƒ£ ì˜ˆì œë¥¼ í†µí•œ ë¹„êµ (ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„)

### ğŸ’¡ í´ë˜ìŠ¤ êµ¬ì¡°

```java
@Entity
public class Team {
    @Id @GeneratedValue
    private Long id;

    private String name;

    @OneToMany(mappedBy = "team")  // â¬… inverse
    private List<Member> members = new ArrayList<>();
}
```

```java
@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;

    private String name;

    @ManyToOne   // â¬… owner
    @JoinColumn(name = "team_id")  // ì™¸ë˜ í‚¤!
    private Team team;
}
```

### ğŸ”„ ì—¬ê¸°ì„œ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ê°€?

* `@JoinColumn(name = "team_id")` â†’ ì´ í•„ë“œê°€ **DBì— ì™¸ë˜ í‚¤ë¥¼ ë§Œë“ ë‹¤.**
* `mappedBy = "team"` â†’ â€œì´ìª½ì€ ë‹¨ì§€ ì—°ê´€ê´€ê³„ë¥¼ ê±°ìš¸ì²˜ëŸ¼ ë°˜ì˜í•˜ëŠ” ê²ƒì´ë©°, DBì— ì˜í–¥ì„ ì£¼ì§€ ë§ë¼â€ëŠ” ì˜ë¯¸

---

## 4ï¸âƒ£ inverse ì„¤ì • ì—†ì´ ì–‘ë°©í–¥ ë§¤í•‘ì„ í•˜ë©´?

```java
@Entity
public class Team {
    @OneToMany
    private List<Member> members = new ArrayList<>();
}
```

ğŸ‘‰ ê·¸ëŸ¬ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

JPAëŠ” \*\*Team-Member ì‚¬ì´ì— ì œ3ì˜ ì¡°ì¸ í…Œì´ë¸”(team\_member)\*\*ì„ ìƒì„±í•œë‹¤.

### ê²°ê³¼

* Teamì—ëŠ” `team_id` ì—†ìŒ
* Memberì—ë„ ì™¸ë˜ í‚¤ ì—†ìŒ
* ëŒ€ì‹  ì¡°ì¸ í…Œì´ë¸”: `team_id`, `member_id`

ì´ê±´ ìš°ë¦¬ê°€ ì˜ë„í•œ êµ¬ì¡°ê°€ ì•„ë‹˜.

---

## 5ï¸âƒ£ inverseëŠ” â€œì™¸ë˜ í‚¤ ê´€ë¦¬ë¥¼ í•˜ì§€ ë§ˆë¼â€ëŠ” ì„ ì–¸ì´ë‹¤

### `mappedBy = "team"`ì´ ì—†ë‹¤ë©´?

```java
Team team = new Team();
Member member = new Member();
team.getMembers().add(member);
em.persist(team);
em.persist(member);
```

â¡ HibernateëŠ” ë‹¤ìŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•¨

```sql
insert into member (id, name, team_id) values (?, ?, null);
```

â¡ ì™¸ë˜ í‚¤ NULL
ì™œ? ì£¼ì¸(owner) ìª½ì¸ `member.team`ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸
**inverseëŠ” DB ë°˜ì˜ ëŒ€ìƒì´ ì•„ë‹ˆë‹¤!**

---

## 6ï¸âƒ£ Hibernateì˜ ë‚´ë¶€ ì²˜ë¦¬ íë¦„

Hibernateì˜ `org.hibernate.engine.spi.ActionQueue`ëŠ” Flush ì‹œì ì— `InsertAction`, `UpdateAction`, `DeleteAction`ì„ ìƒì„±í•©ë‹ˆë‹¤.

### ì£¼ì¸(owner)ì˜ ê²½ìš°:

* ë³€ê²½ ê°ì§€(dirty checking) â†’ `UpdateAction` â†’ ì™¸ë˜ í‚¤ UPDATE ìˆ˜í–‰

### inverseì˜ ê²½ìš°:

* `mappedBy` ì„¤ì • ì‹œ â†’ **ë°ì´í„°ë² ì´ìŠ¤ ì™¸ë˜ í‚¤ ë³€ê²½ ëŒ€ìƒ ì•„ë‹˜**
* ë‹¨ì§€ Java ê°ì²´ ì°¸ì¡°ë§Œ ìœ ì§€

> ğŸ”§ HibernateëŠ” ì˜¤ì§ **ownerì˜ í•„ë“œ ê°’**ë§Œì„ ë³´ê³  ì™¸ë˜ í‚¤ë¥¼ ì„¤ì •í•œë‹¤!

---

## 7ï¸âƒ£ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œëŠ” ì™œ í•„ìš”í•œê°€?

```java
public void addMember(Member member) {
    members.add(member);        // inverse
    member.setTeam(this);       // âœ… owner ì„¤ì •
}
```

ì´ëŸ° ë©”ì„œë“œê°€ ì—†ìœ¼ë©´ ì–‘ë°©í–¥ ê´€ê³„ê°€ **ë¶ˆì¼ì¹˜**í•˜ê²Œ ë˜ì–´ ë°ì´í„°ê°€ ì˜ëª» ì €ì¥ëœë‹¤.

---

## 8ï¸âƒ£ ì˜ˆì œ: inverse ì—†ì´ ì €ì¥í•  ê²½ìš°

```java
team.getMembers().add(member);
em.persist(team);
em.persist(member);
```

**ì´ë•Œ DBì—ëŠ” ì–´ë–»ê²Œ ì €ì¥ë ê¹Œ?**

```sql
insert into member (id, name, team_id) values (?, ?, null);
```

> âŒ ì™¸ë˜ í‚¤ëŠ” NULL
> âŒ Team-Member ì—°ê²° ì•ˆ ë¨
> âŒ ì¡°íšŒ ì‹œ `team.getMembers()`ëŠ” ë¹„ì–´ ìˆê±°ë‚˜ ì´ìƒí•˜ê²Œ ë™ì‘

---

## 9ï¸âƒ£ ì˜ˆì œ: ownerë§Œ ì„¤ì •í–ˆì„ ê²½ìš°

```java
member.setTeam(team);
em.persist(member);
```

ì´ ê²½ìš°ëŠ”?

âœ… HibernateëŠ” `member.team`ì„ ì°¸ì¡°í•˜ì—¬ team\_idë¥¼ ì„¤ì •í•¨
âœ… ì™¸ë˜ í‚¤ëŠ” ì •ìƒ ë°˜ì˜ë¨
âŒ í•˜ì§€ë§Œ `team.getMembers()`ëŠ” ë¹„ì–´ ìˆìŒ

---

## ğŸ”š ì •ë¦¬

| êµ¬ë¶„                         | owner (ì£¼ì¸)           | inverse (ë¹„ì£¼ì¸) |
| -------------------------- | -------------------- | ------------- |
| ì™¸ë˜ í‚¤ ìœ„ì¹˜                    | âœ… ê°€ì§ (`@JoinColumn`) | âŒ ì—†ìŒ          |
| DB ë°˜ì˜ ì£¼ì²´                   | âœ…                    | âŒ             |
| `mappedBy` ì‚¬ìš©              | âŒ                    | âœ… í•„ìˆ˜          |
| ë³€ê²½ ê°ì§€ ëŒ€ìƒ                   | âœ…                    | âŒ             |
| Hibernate insert/update ëŒ€ìƒ | âœ…                    | âŒ             |
| Java ê°ì²´ ì°¸ì¡° ìœ ì§€              | ì„ íƒì‚¬í•­                 | âœ…             |

---

## âœ… ê²°ë¡ 

* `inverse`ëŠ” ë‹¨ìˆœí•œ "ë°˜ëŒ€í¸"ì´ ì•„ë‹ˆë¼, **JPAê°€ ì™¸ë˜ í‚¤ë¥¼ ì œì–´í•˜ì§€ ì•Šë„ë¡ ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸í•˜ëŠ” ì—­í• ì**ì…ë‹ˆë‹¤.
* `mappedBy`ëŠ” JPAì—ê²Œ ë‹¤ìŒì„ ë§í•´ì¤ë‹ˆë‹¤:

  > "ì™¸ë˜ í‚¤ëŠ” ë‚´ê°€ ì•„ë‹ˆë¼, ìƒëŒ€í¸ì´ ê´€ë¦¬í•©ë‹ˆë‹¤. ë‚˜ëŠ” ê±°ìš¸ì²˜ëŸ¼ ë°˜ì˜ë§Œ í•©ë‹ˆë‹¤."

---

## ğŸ“Œ ì‹¤ë¬´ íŒ

1. `ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„`ì—ì„œëŠ” ë°˜ë“œì‹œ `mappedBy`ë¥¼ ì§€ì •í•´ **owner/inverseë¥¼ ëª…í™•íˆ êµ¬ë¶„**í•˜ë¼
2. í•­ìƒ **ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ**ë¥¼ ë§Œë“¤ì–´ì„œ ì–‘ë°©í–¥ ê°ì²´ ë™ê¸°í™”ë¥¼ ìœ ì§€í•˜ë¼
3. ì—”í‹°í‹°ì˜ `equals()`ì™€ `hashCode()`ì—ëŠ” ì—°ê´€ê´€ê³„ í•„ë“œë¥¼ í¬í•¨í•˜ì§€ ë§ˆë¼ (ë¬´í•œ ë£¨í”„ ë°©ì§€)


