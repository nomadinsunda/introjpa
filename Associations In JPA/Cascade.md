# ğŸ“˜ 1. ë¶€ëª¨-ìì‹ ê´€ê³„ë€ ë¬´ì—‡ì¸ê°€?

JPA ë„ë©”ì¸ì—ì„œì˜ ë¶€ëª¨-ìì‹ì€ ë‹¤ìŒê³¼ ê°™ì€ ê´€ê³„ì…ë‹ˆë‹¤:

| ê°œë…     | ì„¤ëª…                                                              |
| ------ | --------------------------------------------------------------- |
| ë¶€ëª¨     | ìì‹ ì—”í‹°í‹°ë¥¼ **ì†Œìœ í•˜ê±°ë‚˜ ì§‘í•©ìœ¼ë¡œ ë³´ìœ **í•˜ëŠ” ì—”í‹°í‹°                                 |
| ìì‹     | ë¶€ëª¨ ì—†ì´ëŠ” ì¡´ì¬ ì˜ë¯¸ê°€ ì—†ê³ , **ë¶€ëª¨ì— ì¢…ì†ì ì¸ ìƒëª…ì£¼ê¸°**ë¥¼ ê°€ì§                         |
| ë„ë©”ì¸ ì˜ˆì‹œ | `Order` â†” `OrderItem`, `Board` â†” `Comment`, `Team` â†” `Player` ë“± |

ì´ëŸ¬í•œ ê´€ê³„ëŠ” ê°ì²´ì§€í–¥ ì„¤ê³„ìƒ ë‹¤ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤:

* ìì‹ì€ í•­ìƒ ë¶€ëª¨ì˜ ìƒëª…ì£¼ê¸°ë¥¼ **í•¨ê»˜ ë”°ë¦…ë‹ˆë‹¤**
* ìì‹ì€ ë…ë¦½ì ìœ¼ë¡œ persist/remove/mergeë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

---

## ğŸ§  í•µì‹¬ ë¬¸ì œ: ì–´ë–»ê²Œ ì´ ê´€ê³„ë¥¼ JPAì— "ì •í™•íˆ ë°˜ì˜"í•  ê²ƒì¸ê°€?

> ë‹µ:
>
> 1. **Cascade ì„¤ì •ì„ í†µí•´ ë¶€ëª¨ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ìì‹ì—ê²Œ ì „íŒŒ**
> 2. **orphanRemoval ì„¤ì •ì„ í†µí•´ ë¶€ëª¨ë¡œë¶€í„° ë¶„ë¦¬ëœ ìì‹ì„ ìë™ ì‚­ì œ**

---

# âœ… 2. ë¶€ëª¨(ë¹„ì£¼ì¸) ìª½ì— `cascade` ì„¤ì •í•˜ëŠ” ê²½ìš°

## âœ” ì¼ë°˜ì ì¸ ë°©ì‹ (ì •ì„)

```java
@Entity
public class Order {
    @OneToMany(mappedBy = "order", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<OrderItem> orderItems = new ArrayList<>();
}
```

```java
@Entity
public class OrderItem {
    @ManyToOne
    @JoinColumn(name = "order_id") // ì£¼ì¸
    private Order order;
}
```

## ğŸ” ì´ ì„¤ì •ì˜ ì˜ë¯¸

* `Order`ëŠ” ë¹„ì£¼ì¸(inverse side)ì´ì§€ë§Œ **ë„ë©”ì¸ ìƒ Aggregate Root**
* ìì‹(`OrderItem`)ì„ ì§ì ‘ ì œì–´í•˜ì§€ ì•Šê³ , ë¶€ëª¨ë¥¼ í†µí•´ì„œë§Œ ì¡°ì‘ë¨
* `Order`ë¥¼ `persist()`í•˜ë©´ **orderItemsë„ ìë™ persist**
* `Order`ì—ì„œ `OrderItem`ì„ `remove()`í•˜ë©´ **DBì—ì„œë„ ì‚­ì œë¨** (`orphanRemoval=true`)

## ğŸ§ª ì‹¤í–‰ ì½”ë“œ

```java
Order order = new Order("í™ê¸¸ë™");
OrderItem item1 = new OrderItem("ì»¤í”¼", 2);
OrderItem item2 = new OrderItem("ì¼€ì´í¬", 1);

order.addItem(item1);
order.addItem(item2);

em.persist(order); // item1, item2 ìë™ persistë¨
```

### âœ… ê²°ê³¼ SQL

```sql
insert into orders (customer) values ('í™ê¸¸ë™');
insert into order_item (product, quantity, order_id) values ('ì»¤í”¼', 2, 1);
insert into order_item (product, quantity, order_id) values ('ì¼€ì´í¬', 1, 1);
```

---

## ğŸ§  ì™œ ì´ê²Œ ì •ì„ì¸ê°€?

* ë„ë©”ì¸ ì„¤ê³„ìƒ **Orderê°€ ì¤‘ì‹¬**ì´ë©°, OrderItemì€ ë¶€ì† ê°ì²´
* Order ì—†ì´ OrderItemì€ ì¡´ì¬í•  ìˆ˜ ì—†ìŒ
* ê°ì²´ ê·¸ë˜í”„ ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ì„ ì œì–´ â†’ `CascadeType.ALL`ê³¼ `orphanRemoval=true`ì˜ ì¡°í•©ì´ í•µì‹¬

---

# âœ… 3. ìì‹(ì£¼ì¸) ìª½ì— `cascade` ì„¤ì •í•˜ëŠ” ê²½ìš°

## âœ” ë¹„ì •í˜•ì ì´ì§€ë§Œ ìœ íš¨í•œ ìƒí™©

```java
@Entity
public class OrderItem {
    @ManyToOne(cascade = CascadeType.PERSIST)
    @JoinColumn(name = "order_id")
    private Order order;
}
```

## ğŸ“Œ ì´ ì„¤ì •ì˜ ì˜ë¯¸

* `OrderItem`ì´ ê´€ê³„ì˜ ì£¼ì¸ (FK ë³´ìœ )
* ìì‹ì´ ìƒì„±ë˜ë©´ì„œ ë¶€ëª¨ë¥¼ ì„¤ì •í•˜ê³ , **ìì‹ persist ì‹œ ë¶€ëª¨ë„ í•¨ê»˜ persist í•˜ê¸¸ ì›í•¨**

## ğŸ§ª ì‹¤í–‰ ì½”ë“œ

```java
Order order = new Order("í™ê¸¸ë™");
OrderItem item = new OrderItem("ì»¤í”¼", 2);
item.setOrder(order);

em.persist(item); // orderë„ í•¨ê»˜ ì €ì¥ë¨ (cascade=PERSIST ë•ë¶„ì—)
```

### âœ… ê²°ê³¼ SQL

```sql
insert into orders (customer) values ('í™ê¸¸ë™');
insert into order_item (product, quantity, order_id) values ('ì»¤í”¼', 2, 1);
```

---

## ğŸ§  ì–¸ì œ ì´ëŸ° êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë‚˜?

| ì‚¬ìš© ì‹œì                | ì„¤ëª…                                                        |
| ------------------- | --------------------------------------------------------- |
| ë„ë©”ì¸ íë¦„ì´ í•˜ìœ„ ê°ì²´ ì¤‘ì‹¬ì¼ ë•Œ | ì˜ˆ: í•™ìƒ(Student)ì´ ë°˜(Classroom)ì„ ìƒì„±í•´ì„œ ì†í•˜ëŠ” íë¦„                 |
| ë‹¨ë°©í–¥ ê´€ê³„ì¼ ë•Œ           | `@ManyToOne` ë‹¨ë°©í–¥ ê´€ê³„ì—ì„œëŠ” cascadeë¥¼ **ìì‹(ì£¼ì¸)** ìª½ì— ì„¤ì •í•˜ëŠ” ìˆ˜ë°–ì— ì—†ìŒ |
| ì„ì‹œ ì €ì¥ìš© ë¶€ëª¨ê°€ í•„ìš”í•  ë•Œ    | ìì‹ ì¤‘ì‹¬ ì €ì¥ ë¡œì§ì—ì„œ ë¶€ëª¨ê¹Œì§€ ì „íŒŒí•  ìˆ˜ ìˆì–´ ìœ ìš©                            |

---

## â— ë¬¸ì œì  ë° í•œê³„

* ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ ì² í•™ê³¼ ì–´ê¸‹ë‚  ìˆ˜ ìˆìŒ (ìì‹ì´ ë¶€ëª¨ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê´€ë¦¬í•¨)
* `CascadeType.REMOVE` ì‚¬ìš© ì‹œ í° ë¬¸ì œ ë°œìƒ ê°€ëŠ¥

```java
@ManyToOne(cascade = CascadeType.REMOVE)
private Department department;
```

* ì—¬ëŸ¬ ìì‹ì´ ê°™ì€ ë¶€ëª¨ë¥¼ ì°¸ì¡°í•  ê²½ìš°, í•˜ë‚˜ ì‚­ì œ ì‹œ ë¶€ëª¨ë„ ì‚­ì œë¨ â†’ **ì°¸ì¡° ë¬´ê²°ì„± ìœ„ë°˜**

---

# ğŸ“Š ì¢…í•© ë¹„êµ

| í•­ëª©         | ë¶€ëª¨(ë¹„ì£¼ì¸)ì— cascade ì„¤ì •                  | ìì‹(ì£¼ì¸)ì— cascade ì„¤ì •      |
| ---------- | ------------------------------------ | ----------------------- |
| ê¶Œì¥ë„        | âœ… ì¼ë°˜ì ì´ë©° ê¶Œì¥                           | âš ï¸ íŠ¹ì • ìƒí™©ì—ë§Œ ê¶Œì¥           |
| ë„ë©”ì¸ íë¦„     | ë¶€ëª¨ ì¤‘ì‹¬ (ì •ì„)                           | ìì‹ì´ íë¦„ ì‹œì‘ì ì¼ ë•Œ           |
| ê´€ê³„ ë°©í–¥      | ì–‘ë°©í–¥ or ë‹¨ë°©í–¥                           | ì£¼ë¡œ ë‹¨ë°©í–¥                  |
| persist ì „íŒŒ | ë¶€ëª¨ persist ì‹œ ìì‹ ì „íŒŒ                   | ìì‹ persist ì‹œ ë¶€ëª¨ ì „íŒŒ      |
| remove ì „íŒŒ  | ì•ˆì „í•¨ (ë‹¨, orphanRemoval=trueë§Œ ì„¤ì •í•´ë„ ì¶©ë¶„) | ë§¤ìš° ìœ„í—˜í•¨ (ê³µìœ  ìì› ì‚­ì œ ìœ„í—˜)    |
| ì˜ˆì‹œ         | `Order` â†” `OrderItem`                | `Student` â†’ `Classroom` |

---

# âœ… ê²°ë¡ 

| ì§ˆë¬¸                                    | ë‹µë³€                                                                           |
| ------------------------------------- | ---------------------------------------------------------------------------- |
| ë¶€ëª¨-ìì‹ ê´€ê³„ì—ì„œ cascadeëŠ” ì–´ë””ì— ì„¤ì •í•´ì•¼ í•˜ë‚˜ìš”?     | ì¼ë°˜ì ìœ¼ë¡œ **ë¶€ëª¨(ë¹„ì£¼ì¸)** ìª½ì— ì„¤ì •í•˜ëŠ” ê²ƒì´ ë„ë©”ì¸ ëª¨ë¸ê³¼ ê°ì²´ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì¥ ì˜ ë°˜ì˜í•©ë‹ˆë‹¤.                    |
| ì£¼ì¸ ìª½ì— cascade ì„¤ì •ì€ í‹€ë¦° ê±´ê°€ìš”?             | âŒ ì•„ë‹™ë‹ˆë‹¤. **ë‹¨ë°©í–¥ ê´€ê³„**ë‚˜ **ë„ë©”ì¸ íë¦„ì´ ìì‹ ì¤‘ì‹¬ì¸ ê²½ìš°**ì—ëŠ” ìœ íš¨í•©ë‹ˆë‹¤. ë‹¨, ì œí•œì ì´ë©° ì„¤ê³„ ì˜ë„ê°€ ëšœë ·í•´ì•¼ í•©ë‹ˆë‹¤. |
| `CascadeType.REMOVE`ë¥¼ ì£¼ì¸ ìª½ì— ì„¤ì •í•´ë„ ë˜ë‚˜ìš”? | âŒ ê°•ë ¥íˆ ë¹„ì¶”ì²œ. ê³µìœ  ìì› ì‚­ì œë¡œ ì¸í•´ ì°¸ì¡° ë¬´ê²°ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.                                   |

