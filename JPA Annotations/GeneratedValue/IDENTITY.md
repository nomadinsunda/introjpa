# β… SQL ν‘μ¤€μ IDENTITY μ»¬λΌμ΄λ€?

`IDENTITY` μ»¬λΌμ€ \*\*SQL ν‘μ¤€ (SQL:2003\~SQL:2011)\*\*μ—μ„ λ„μ…λ κΈ°λ¥μΌλ΅,
**μλ™μΌλ΅ μ¦κ°€ν•λ” μ •μ κ°’μ„ κ°€μ§€λ” κΈ°λ³Έν‚¤(primary key) ν•„λ“**λ¥Ό μ„ μ–Έν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

μ΄λ” λ°μ΄ν„°λ² μ΄μ¤ λ λ²¨μ—μ„ κ°’μ„ μλ™ μƒμ„±ν•λ©°, λ‹¤μκ³Ό κ°™μ€ νΉμ§•μ„ κ°€μ§‘λ‹λ‹¤:

* **DBMSκ°€ μλ™μΌλ΅ μ«μ κ°’μ„ μƒμ„±**
* **λ…μ‹μ μΌλ΅ μ‹ν€€μ¤λ¥Ό λ§λ“¤μ§€ μ•μ•„λ„ λ¨**
* **SQL ν‘μ¤€ μ¤€μ β†’ μ΄μ‹μ„± μ¦κ°€**

---

## π“ 1. κΈ°λ³Έ λ¬Έλ²•

```sql
column_name data_type GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY
    [ ( START WITH start_num
        INCREMENT BY step
        MINVALUE min
        MAXVALUE max
        CYCLE | NO CYCLE
        CACHE n
    ) ]
```

| μ”μ†                     | μ„¤λ…                       |
| ---------------------- | ------------------------ |
| `GENERATED`            | ν•„μ ν‚¤μ›λ“, μλ™ μƒμ„± μ»¬λΌμ„μ„ λ…μ‹    |
| `ALWAYS`               | μ‚¬μ©μκ°€ μ§μ ‘ κ°’μ„ μ§€μ •ν•λ ¤ ν•λ©΄ μ¤λ¥ λ°μƒ |
| `BY DEFAULT`           | μ‚¬μ©μκ°€ κ°’ μ§€μ • κ°€λ¥, μ—†μΌλ©΄ μλ™ μƒμ„±  |
| `AS IDENTITY`          | IDENTITY μ—΄μ„μ„ λ…μ‹          |
| `START WITH`           | μ‹ν€€μ¤ μ‹μ‘ κ°’ (κΈ°λ³Έ: 1)         |
| `INCREMENT BY`         | μ¦κ°€ κ°„κ²© (κΈ°λ³Έ: 1)            |
| `MINVALUE`, `MAXVALUE` | μƒμ„± κ°€λ¥ν• μµμ†/μµλ€ κ°’           |
| `CYCLE`                | λ²”μ„ μ΄κ³Ό μ‹ μ¬μ‹μ‘ μ—¬λ¶€           |
| `CACHE`                | λ―Έλ¦¬ μƒμ„±ν•΄ μΊμ‹μ— λ³΄κ΄€ν•  κ°μ        |

---

## π“ 2. μμ : κΈ°λ³Έ μ‚¬μ©

### `GENERATED ALWAYS AS IDENTITY` (κ°€μ¥ μ—„κ²©ν• λ°©μ‹)

```sql
CREATE TABLE users (
  id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  username TEXT NOT NULL
);
```

> β οΈ μλ™ κ°’ μ‚½μ… μ‹ μ¤λ¥ λ°μƒ

```sql
INSERT INTO users (id, username) VALUES (100, 'admin');  -- β μ¤λ¥ λ°μƒ
```

### `GENERATED BY DEFAULT AS IDENTITY`

```sql
CREATE TABLE users (
  id INT GENERATED BY DEFAULT AS IDENTITY,
  name TEXT
);
```

> β… μ‚¬μ©μκ°€ κ°’μ„ μ§€μ •ν•  μλ„ μκ³ , μ§€μ •ν•μ§€ μ•μΌλ©΄ μλ™μΌλ΅ ν• λ‹Ήλ©λ‹λ‹¤.

```sql
-- μλ™ μ¦κ°€
INSERT INTO users(name) VALUES ('Alice');

-- μλ™ μ§€μ • κ°€λ¥
INSERT INTO users(id, name) VALUES (100, 'Bob');
```

---

## π” 3. λ‚΄λ¶€ λ™μ‘ (PostgreSQL κΈ°μ¤€)

PostgreSQLμ€ μ΄ κµ¬λ¬Έμ„ λ‚΄λ¶€μ μΌλ΅ **μ‹ν€€μ¤ κΈ°λ°**μΌλ΅ λ³€ν™ν•©λ‹λ‹¤:

```sql
-- GENERATED ALWAYS AS IDENTITY
CREATE SEQUENCE users_id_seq START 1 INCREMENT 1;
ALTER TABLE users ALTER COLUMN id SET DEFAULT nextval('users_id_seq');
```

μ¦‰, **IDENTITYλ” μ‹ν€€μ¤μ λ¬Έλ²•μ  μ¶”μƒν™”**μ΄λ©°,
μ‹¤μ λ΅λ” `nextval()` μ‹ν€€μ¤ νΈμ¶κ³Ό λ™μΌν• ν¨κ³Όλ¥Ό λƒ…λ‹λ‹¤.

---

## π§ 4. IDENTITY vs SEQUENCE vs SERIAL

| ν•­λ©          | SERIAL | SEQUENCE | IDENTITY             |
| ----------- | ------ | -------- | -------------------- |
| SQL ν‘μ¤€ νΈν™   | β      | β        | β…                    |
| λ‚΄λ¶€ μ‹ν€€μ¤ μƒμ„±   | μλ™     | μλ™       | μλ™                   |
| μ μ–΄ μ μ—°μ„±      | λ‚®μ     | λ†’μ       | μ¤‘κ°„                   |
| JPA μ‚¬μ© μ‹ κ¶μ¥ | β      | β…        | μΌλ¶€ β…                 |
| μ΄λ¦„ μ§€μ • κ°€λ¥    | β      | β…        | β (μ‹ν€€μ¤ μ΄λ¦„ λ‚΄λ¶€μ μΌλ΅ κ΄€λ¦¬λ¨) |
| μλ™ κ°’ ν—μ©     | κ°€λ¥     | κ°€λ¥       | `BY DEFAULT`λ§ κ°€λ¥     |

---

## π’΅ 5. IDENTITYμ μ¥μ κ³Ό ν•κ³„

### β… μ¥μ 

* β… **SQL ν‘μ¤€ νΈν™** β†’ PostgreSQL, SQL Server, DB2 λ“± λ‹¤μ–‘ν• DBMSμ—μ„ λ™μΌν• λ°©μ‹ μ‚¬μ© κ°€λ¥
* β… **λ…μ‹μ  μ‹ν€€μ¤ μ—†μ΄ μλ™ μ¦κ°€ κ°’ μ κ³µ**
* β… **μλ„ λ…ν™•**: μλ™ κ°’ ν—μ© μ—¬λ¶€λ¥Ό μµμ…μΌλ΅ μ μ–΄

### β οΈ λ‹¨μ 

* β μ‹ν€€μ¤ μ΄λ¦„μ„ μ§μ ‘ μ§€μ •ν•  μ μ—†μ (Hibernate μ—°λ™ λ¶νΈ)
* β μ‹ν€€μ¤ κ³µμ  λ¶κ°€ (μ—¬λ¬ ν…μ΄λΈ”μ—μ„ κ°™μ€ μ‹ν€€μ¤ μ‚¬μ© λ»ν•¨)
* β μΌλ¶€ DBμ—μ„λ” μΊμ‹/μ„±λ¥ μ μ–΄κ°€ μ ν•λ¨
* β PostgreSQLμ—μ„λ” `IDENTITY` μ‚¬μ© μ‹ `RETURNING id` κ²°κ³Όκ°€ `0`μ΄ λλ” κ²½μ° μ΅΄μ¬ (JDBC μ—°λ™ μ£Όμ)

---

## π”„ 6. Hibernateμ—μ„ IDENTITY μ‚¬μ©

```java
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String username;
}
```

* μ΄ κ²½μ° PostgreSQLμ—μ„λ” \*\*`SERIAL` λλ” `GENERATED AS IDENTITY`\*\*λ΅ μλ™ μƒμ„±λ©λ‹λ‹¤.
* Hibernateλ” DB Dialectμ— λ”°λΌ `IDENTITY` μ „λµμΌ κ²½μ° \*\*INSERT ν›„ `lastval()`\*\*μ„ μ‚¬μ©ν•μ—¬ PKλ¥Ό μ–»μµλ‹λ‹¤.

---

## π” 7. μ‹ν€€μ¤ νλΌλ―Έν„° μ΅°ν (PostgreSQL)

```sql
SELECT * FROM information_schema.sequences
WHERE sequence_name = 'users_id_seq';
```

λλ” IDENTITY μ—΄ μ΅°ν:

```sql
SELECT column_name, is_identity, identity_generation
FROM information_schema.columns
WHERE table_name = 'users';
```

---

## β… λ§λ¬΄λ¦¬ μ”μ•½

| ν•­λ©     | μ„¤λ…                                           |                           |
| ------ | -------------------------------------------- | ------------------------- |
| μ •μ     | SQL ν‘μ¤€μ— λ”°λ¥Έ μλ™ μ¦κ°€ κΈ°λ³Έν‚¤ μƒμ„± λ°©μ‹                   |                           |
| ν•µμ‹¬ λ¬Έλ²•  | \`GENERATED \[ALWAYS                         | BY DEFAULT] AS IDENTITY\` |
| λ‚΄λ¶€ κµ¬ν„  | μ‹ν€€μ¤λ¥Ό μλ™ μƒμ„±ν•μ—¬ μ‚¬μ©                              |                           |
| νΈν™ DB  | PostgreSQL 10+, Oracle 12c+, SQL Server, DB2 |                           |
| JPA μ§€μ› | μΌλ¶€ Hibernate Dialectμ—μ„λ” μ§€μ›                   |                           |
| κ¶μ¥ μƒν™©  | ν‘μ¤€ SQLμ„ μ¤‘μ‹ν•κ³  μ΄μ‹μ„±μ„ κ³ λ ¤ν•  λ•                      |                           |

---

μ¶”κ°€λ΅ λ‹¤μ μ‚¬ν•­μ„ κ³ λ ¤ν•΄ λ³Ό ν•„μ”κ°€ μμµλ‹λ‹¤:

* PostgreSQL, Oracle, SQL Serverμ—μ„ `IDENTITY` μ „λµ λΉ„κµ μ‹¤μµ
* Hibernate + PostgreSQLμ—μ„ `IDENTITY` μ „λµ μ‚¬μ© μ‹ μ„±λ¥κ³Ό μ΄μ λ¶„μ„
* JPAμ `@GeneratedValue(strategy = GenerationType.IDENTITY)`μ™€ SQL ν‘μ¤€ κ°„μ λ§¤ν•‘ μ „λµ
